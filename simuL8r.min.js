function getQueryVariable(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}return!1}function circleMaker(){for(var a=50,b=30,c=0;a>c;c++)x=b*Math.cos(2*c*Math.PI/a),y=b*Math.sin(2*c*Math.PI/a),circularArray.push([x,y])}function resetRotate(){$("#reverseX").css("color","#A3FFA3"),$("#reverseY").css("color","#A3FFA3"),$("#rotate90").css("color","#A3FFA3"),$("#rotate180").css("color","#A3FFA3"),$("#reverseX").css("text-decoration","none"),$("#reverseY").css("text-decoration","none"),$("#rotate90").css("text-decoration","none"),$("#rotate180").css("text-decoration","none"),reversingX=!1,reversingY=!1,rotating90=!1,rotating180=!1}function pencilStyle(){pencils?pencils&&$("#pencilList").css("display","none"):$("#pencilList").css("display","inline-block")}function rotateListStyle(){rotate?rotate&&$("#rotateList").css("display","none"):$("#rotateList").css("display","inline-block")}function listStyleCallback(){!onBar&&rotate&&$("#rotateList").fadeOut(1e3),!onBar&&pencils&&$("#pencilList").fadeOut(1e3)}function distance(a,b){return Math.sqrt(a*a+b*b)}function angleFinder(a,b,c,d){var e=a*c+b*d,f=distance(a,b)*distance(c,d);return Math.acos(e/f)}function angleCalc(a,b,c,d){var e=angleFinder(Math.abs(a),Math.abs(b),Math.abs(c),Math.abs(d));if(b>=0&&a>=0||b>=0&&0>=a){var f=a*c+b*d,g=distance(a,b)*distance(c,d);return Math.acos(f/g)}if(0>=b&&0>=a){var f=a*c+b*d,g=distance(a,b)*distance(c,d);return Math.PI+e}if(0>=b&&a>=0){var f=a*c+b*d,g=distance(a,b)*distance(c,d);return 2*Math.PI-e}}function rotater2(a,b,c,d,e){var f=distance(c-a,d-b),g=angleCalc(c-a,d-b,f,0),h=g+e,i=a+f*Math.cos(h)-c,j=b+f*Math.sin(h)-d;return[i,j]}function shifter(a,b,c){var d=b.width,e=b.height,f=window.innerHeight,g=window.innerWidth;b.width<=g&&a.width>g&&(setCanvasSize(canvas,g,f),setCanvasSize(bufferCanvas,g,f),a.height=f);var h=a.height-b.height;if(h>0)for(var i in c)for(var j=c[i][2].length,k=0;j>k;k++)c[i][2][k].Y+=h;else 0>h&&(setCanvasSize(canvas,d,e),setCanvasSize(bufferCanvas,d,e))}function wallMaker(){var a=0;wallArray=[],console.log("wallArray: ",wallArray);for(var b=0;4>b;b++)0===b&&(wallGen(),wallArray[b].vertices=[[-2e3,-canvas.height],[1020,-canvas.height],[1020,canvas.height],[-2e3,canvas.height],[-2e3,-canvas.height]],wallArray[b].X=-1021,wallArray[b].Y=canvas.height/2,wallArray[b].colour="red",wallArray[b].setOuterRadius=function(){return a}),1===b&&(wallGen(),wallArray[b].vertices=[[-1020,-canvas.height],[2e3,-canvas.height],[2e3,canvas.height],[-1020,canvas.height],[-1020,-canvas.height+80]],wallArray[b].X=canvas.width+21+1e3,wallArray[b].Y=canvas.height/2-30,wallArray[b].colour="red",wallArray[b].setOuterRadius=function(){return a}),2===b&&(wallGen(),wallArray[b].vertices=[[-canvas.width/2,-1020],[canvas.width/2,-1020],[canvas.width/2,2e3],[-canvas.width/2,2e3],[-canvas.width/2,-1020]],wallArray[b].X=canvas.width/2,wallArray[b].Y=canvas.height+21+1e3,wallArray[b].colour="red",wallArray[b].setOuterRadius=function(){return a}),3===b&&(wallGen(),wallArray[b].vertices=[[-canvas.width/2,-2e3],[canvas.width/2,-2e3],[canvas.width/2,1009],[-canvas.width/2,1009],[-canvas.width/2,-2e3]],wallArray[b].X=canvas.width/2,wallArray[b].Y=-1010,wallArray[b].colour="red",wallArray[b].setOuterRadius=function(){return a});shapeSelection.shapes.wall[2]=wallArray}function setCanvasSize(a,b,c){$(a).prop("width",b),$(a).prop("height",c),shapeSelection.canvas={width:b,height:c},$("#navigation-bar").css({width:b}),$(".main-sidebar").css({height:c+100+"px"}),$("#barnav").css({width:b})}function init(){circleMaker(),selectPencilStroke(),pencilCursor(),mousePos=0,canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),setCanvasSize(canvas,window.innerWidth-230,window.innerHeight-100),window.onresize=function(a){},body=document.getElementById("body"),bar=document.getElementById("bar"),bar.style.width=window.innerWidth+"px",bufferCanvas=document.createElement("canvas"),bufferCtx=bufferCanvas.getContext("2d"),bufferCtx.canvas.width=context.canvas.width,bufferCtx.canvas.height=context.canvas.height,shapeSelection.canvas={width:context.canvas.width,height:context.canvas.height},options(),locate(),mouseMove(),mouseDown(),mouseUp(),eraser(),animate(),intervalRunning=!0,playScenes=setInterval(animator,1e3/frame_Rate),console.log("####################animating"),wallMaker(),canvas.dispatchEvent(canvasReadyEvent)}function options(){circle=document.getElementById("circle"),square=document.getElementById("square"),triangle=document.getElementById("triangle"),ReSize=document.getElementById("Re-Size"),ReShape=document.getElementById("Re-Shape"),Rotate=document.getElementById("Rotate"),ChangeColour=document.getElementById("ChangeColour"),none=document.getElementById("none"),erase=document.getElementById("erase"),save=document.getElementById("save"),image=document.getElementById("canvasImg"),customShape=document.getElementById("customShape"),curve=document.getElementById("line"),pencil_id=document.getElementById("pencil_id"),Copy=document.getElementById("copy"),Physics=document.getElementById("physics")}function animate(){draw(),requestAnimFrame(function(){animate()})}function locate(){onObject=!1;for(key in shapeSelection.shapes){for(var a=0;a<shapeSelection.shapes[key][2].length;a++)shapeSelection.shapes[key][2][a].selected&&(onObject=!0,dragging||pencils||(canvas.style.cursor=cursor_drag));0==onObject&&(pencils||(canvas.style.cursor="auto"))}}function mouseMove(){canvas.addEventListener("mousemove",function(a){mousePos=getMousePos(canvas,a),select||(copying=!0),locate(),pencilPoints(),dragging||selected(),physMove()},!1)}function mouseDown(){canvas.addEventListener("mousedown",function(a){mouse_down=!0,shapeSelection.shapes.curve.curveArray&&console.log(shapeSelection.shapes.curve.curveArray.length),eraser(),rotater(),reSizer(),drag(),pointStart(),reShaper(),physTest();pencils&&(startPencil=!0)},!1)}function mouseUp(){canvas.addEventListener("mouseup",function(a){mouse_down=!1,onSlider=!1,startPencil=!1,superPencilPointsMachine(),copyShape(),drop(),stopResize(),reShape&&offReshaper(),clearPhysMove()},!1)}function pencilPoints(){pencils&&startPencil&&pencilPointsArray.push([mousePos.x,mousePos.y])}function superPencilPointsMachine(){pencils&&superPencilPoints.push(pencilPointsArray)}function pencilCursor(){pencils?$("canvas").css("cursor","url(images/pencil_cursor.png) 0 15, auto"):$("canvas").css("cursor","pointer")}function selectPencilStroke(){$("#shapes").css("color","white"),$("#shapes").css("text-decoration","underline"),pencil_id=document.getElementById("pencil_id"),hover(pencil_id)}function drag(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)!shapeSelection.shapes[key][2][a].selected||dragging||onReshape||onSlider||shapeSelection.shapes[key][2][a].expand||shapeSelection.shapes[key][2][a].v_expand||shapeSelection.shapes[key][2][a].h_expand||(offcenter[0]=shapeSelection.shapes[key][2][a].X-mousePos.x,offcenter[1]=shapeSelection.shapes[key][2][a].Y-mousePos.y,dragging=!0,shapeSelection.shapes[key][2][a].dragging=!0,shapeSelection.shapes[key][2][a].onObject=!0,shapeSelection.shapes[key][2][a].locateTouchPoint(),shapeSelection.shapes[key][2][a].velocity=[0,0],pencils||(canvas.style.cursor=cursor_grab),selectedShape[0]=shapeSelection.shapes[key][2][a],selectedShape[1]=key,console.log("selectedShape: ",selectedShape))}function selected(){select=!1;for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++){shapeSelection.shapes[key][2][a].selected=!1,bufferCtx.beginPath(),bufferCtx.moveTo(shapeSelection.shapes[key][2][a].vertices[0][0]+shapeSelection.shapes[key][2][a].X,shapeSelection.shapes[key][2][a].vertices[0][1]+shapeSelection.shapes[key][2][a].Y);for(var b=0;b<shapeSelection.shapes[key][2][a].vertices.length;b++)bufferCtx.lineTo(shapeSelection.shapes[key][2][a].vertices[b][0]+shapeSelection.shapes[key][2][a].X,shapeSelection.shapes[key][2][a].vertices[b][1]+shapeSelection.shapes[key][2][a].Y);bufferCtx.isPointInPath(mousePos.x,mousePos.y)&&!select&&distance(shapeSelection.shapes[key][2][a].slider[0]-mousePos.x,shapeSelection.shapes[key][2][a].slider[1]-mousePos.y)>=10&&(shapeSelection.shapes[key][2][a].selected=!0,select=!0)}}function drop(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)dragging=!1,shapeSelection.shapes[key][2][a].dragging=!1,shapeSelection.shapes[key][2][a].onObject=!1,pencils||(canvas.style.cursor=cursor_drag)}function eraser(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)shapeSelection.shapes[key][2][a].selected&&deletion&&shapeSelection.shapes[key][2].splice(a,1)}function reSizer(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++){if(shapeSelection.shapes[key][2][a].selected&&reSize){shapeSelection.shapes[key][2][a].expandBox=!0;for(keys in shapeSelection.shapes)if("userID"!=keys&&"isPublic"!=keys&&"name"!=keys)for(var b=0;b<shapeSelection.shapes[keys][2].length;b++)key!=keys?shapeSelection.shapes[keys][2][b].expandBox=!1:b!=a&&(shapeSelection.shapes[keys][2][b].expandBox=!1)}(distance(shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.y)<=smallBox/2||distance(shapeSelection.shapes[key][2][a].X+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.y)<=smallBox/2||distance(shapeSelection.shapes[key][2][a].X+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.y)<=smallBox/2||distance(shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.y)<=smallBox/2)&&shapeSelection.shapes[key][2][a].expandBox&&(shapeSelection.shapes[key][2][a].expand=!0,pencils||(canvas.style.cursor=cursor_grab)),(distance(shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y-mousePos.y)<=smallBox/2||distance(shapeSelection.shapes[key][2][a].X+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.x,shapeSelection.shapes[key][2][a].Y-mousePos.y)<=smallBox/2)&&shapeSelection.shapes[key][2][a].expandBox&&("customShape"==key,shapeSelection.shapes[key][2][a].h_expand=!0,pencils||(canvas.style.cursor=cursor_grab)),(distance(shapeSelection.shapes[key][2][a].X-mousePos.x,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[key][2][a].stretchRadius-selectSize-mousePos.y)<=smallBox/2||distance(shapeSelection.shapes[key][2][a].X-mousePos.x,shapeSelection.shapes[key][2][a].Y+shapeSelection.shapes[key][2][a].stretchRadius+selectSize-mousePos.y)<=smallBox/2)&&shapeSelection.shapes[key][2][a].expandBox&&("customShape"==key,shapeSelection.shapes[key][2][a].v_expand=!0,pencils||(canvas.style.cursor=cursor_grab))}}function stopResize(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)expand=!1,(shapeSelection.shapes[key][2][a].expand||shapeSelection.shapes[key][2][a].v_expand||shapeSelection.shapes[key][2][a].h_expand)&&(shapeSelection.shapes[key][2][a].stretchRadius=shapeSelection.shapes[key][2][a].radius,shapeSelection.shapes[key][2][a].calculateMass(shapeSelection.shapes[key][2][a].vertices,shapeSelection.shapes[key][2][a].boundingRectangle.width,shapeSelection.shapes[key][2][a].boundingRectangle.height,resolution)),shapeSelection.shapes[key][2][a].expand=!1,shapeSelection.shapes[key][2][a].v_expand=!1,shapeSelection.shapes[key][2][a].h_expand=!1}function pointStart(){if((shapes||line)&&!onObject&&!select)if(startDraw=!0,closedPath)pointsArray.push([pointsArray[0][0],pointsArray[0][1]]),startDraw=!1;else{var a=pointsArray[pointsArray.length-1];pointsArray.push([mousePos.x,mousePos.y]),clickCount=1,pointsArray.length>1&&pointsArray[0]&&distance(mousePos.x-a[0],mousePos.y-a[1])<closePathRadius&&(clickCount+=1)}}function rotateListSwitch(a,b,c){switch(!0){case reversingX:shapeSelection.shapes[a][2][c].reverseX(b);break;case reversingY:shapeSelection.shapes[a][2][c].reverseY(b);break;case rotating90:shapeSelection.shapes[a][2][c].rotate90(b);break;case rotating180:shapeSelection.shapes[a][2][c].rotate180(b)}}function rotater(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++){if(shapeSelection.shapes[key][2][a].selected&&rotate){shapeSelection.shapes[key][2][a].referencer();var b=shapeSelection.shapes[key][2][a].vertices;rotateListSwitch(key,b,a),shapeSelection.shapes[key][2][a].rotationLine||(sliderPosition=shapeSelection.shapes[key][2][a].sliderPosition),shapeSelection.shapes[key][2][a].rotationLine=!0;for(keys in shapeSelection.shapes)if("userID"!=keys&&"isPublic"!=keys&&"name"!=keys)for(var c=0;c<shapeSelection.shapes[keys][2].length;c++)key!=keys?shapeSelection.shapes[keys][2][c].rotationLine=!1:c!=a&&(shapeSelection.shapes[keys][2][c].rotationLine=!1)}distance(shapeSelection.shapes[key][2][a].slider[0]-mousePos.x,shapeSelection.shapes[key][2][a].slider[1]-mousePos.y)<=10&&(onSlider=!0)}}function referencer(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)distance(shapeSelection.shapes[key][2][a].slider[0]-mousePos.x,shapeSelection.shapes[key][2][a].slider[1]-mousePos.y)<=1e5&&shapeSelection.shapes[key][2][a].referencer()}function reShaper(){if(reShape)for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)for(var b=0;b<shapeSelection.shapes[key][2][a].vertices.length;b++){shapeSelection.shapes[key][2][a].vertices[b][2]=!1;var c=shapeSelection.shapes[key][2][a].vertices[b][0]+shapeSelection.shapes[key][2][a].X,d=shapeSelection.shapes[key][2][a].vertices[b][1]+shapeSelection.shapes[key][2][a].Y;distance(c-mousePos.x,d-mousePos.y)<5&&(shapeSelection.shapes[key][2][a].vertices[b][2]=!0,currentlyReshaping=key)}}function offReshaper(){for(key in shapeSelection.shapes)for(var a=[0,0],b=0;b<shapeSelection.shapes[key][2].length;b++){shapeSelection.shapes[key][2][b].centroid=[0,0];for(var c=0;c<shapeSelection.shapes[key][2][b].pointsArray.length-1;c++)shapeSelection.shapes[key][2][b].centroid[0]+=shapeSelection.shapes[key][2][b].X+shapeSelection.shapes[key][2][b].vertices[c][0],shapeSelection.shapes[key][2][b].centroid[1]+=shapeSelection.shapes[key][2][b].Y+shapeSelection.shapes[key][2][b].vertices[c][1];shapeSelection.shapes[key][2][b].centroid[0]/=shapeSelection.shapes[key][2][b].pointsArray.length-1,shapeSelection.shapes[key][2][b].centroid[1]/=shapeSelection.shapes[key][2][b].pointsArray.length-1,a[0]=shapeSelection.shapes[key][2][b].centroid[0]-shapeSelection.shapes[key][2][b].X,a[1]=shapeSelection.shapes[key][2][b].centroid[1]-shapeSelection.shapes[key][2][b].Y;for(var d=a[0],e=a[1],f=0;f<shapeSelection.shapes[key][2][b].pointsArray.length;f++)shapeSelection.shapes[key][2][b].vertices[f][0]-=d,shapeSelection.shapes[key][2][b].vertices[f][1]-=e;shapeSelection.shapes[key][2][b].X=shapeSelection.shapes[key][2][b].centroid[0],shapeSelection.shapes[key][2][b].Y=shapeSelection.shapes[key][2][b].centroid[1];for(var g=0;g<shapeSelection.shapes[key][2][b].vertices.length;g++)shapeSelection.shapes[key][2][b].vertices[g][2]=!1;shapeSelection.shapes[key][2][b].referencer(),shapeSelection.shapes[key][2][b].findOuterRadius(),currentlyReshaping==key&&shapeSelection.shapes[key][2][b].calculateMass(shapeSelection.shapes[key][2][b].vertices,shapeSelection.shapes[key][2][b].boundingRectangle.width,shapeSelection.shapes[key][2][b].boundingRectangle.height,resolution)}}function copyShape(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)if(copy&&copying&&shapeSelection.shapes[key][2][a].selected){copying=!1;var b={};for(var c in shapeSelection.shapes[key][2][a])b[c]=shapeSelection.shapes[key][2][a][c];b.rotationLine=!1,b.expandBox=!1,b.vertices=[],b.referenceVertices=[];for(var d=0;d<shapeSelection.shapes[key][2][a].vertices.length;d++)b.vertices[d]=shapeSelection.shapes[key][2][a].vertices[d],b.referenceVertices[d]=shapeSelection.shapes[key][2][a].referenceVertices[d];for(var e=0;e<shapeSelection.shapes[key][2][a].pointsArray.length;e++)b.pointsArray[e]=[[],[]],b.pointsArray[e][0]=shapeSelection.shapes[key][2][a].X+shapeSelection.shapes[key][2][a].vertices[e][0],b.pointsArray[e][1]=shapeSelection.shapes[key][2][a].Y+shapeSelection.shapes[key][2][a].vertices[e][1];b.X=0,b.Y=0;var f;centralize(b,b.pointsArray,f),b.X=mousePos.x+5,b.Y=mousePos.y+5,copying||shapeSelection.shapes[key][2].push(b)}}function rotateObject(a,b){for(var c=0;c<a.length;c++){var d=rotater2(0,0,a[c][0],a[c][1],b);a[c][0]+=d[0],a[c][1]+=d[1]}}function closestPoint(a,b){for(var c=b.map(function(b){return distance(b[0]-a[0],b[1]-a[1])}),d=function(){return Math.min.apply(null,c)},e=0;e<c.length;e++)if(c[e]===d())return b[e]}function animator(){for(key in shapeSelection.shapes)if("userID"!=key&&"isPublic"!=key&&"name"!=key)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)if(physics){shapeSelection.shapes[key][2][a].X+=shapeSelection.shapes[key][2][a].velocity[0],shapeSelection.shapes[key][2][a].Y+=shapeSelection.shapes[key][2][a].velocity[1];for(var b=0;b<shapeSelection.shapes[key][2][a].vertices.length;b++){var c=rotater2(0,0,shapeSelection.shapes[key][2][a].vertices[b][0],shapeSelection.shapes[key][2][a].vertices[b][1],shapeSelection.shapes[key][2][a].angularVelocity);shapeSelection.shapes[key][2][a].vertices[b][0]+=c[0],shapeSelection.shapes[key][2][a].vertices[b][1]+=c[1]}}collisionDetector()}function getMousePos(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function rotationRecalculation(a){for(var b=0;b<a.pointsArray.length;b++){var c=rotater2(0,0,a.referenceVertices[b][0],a.referenceVertices[b][1],2*sliderPosition*Math.PI/sliderButtonWidth);rotVertices2[b]=[0,0],rotVertices2[b][0]=c[0],rotVertices2[b][1]=c[1]}}function CustomShape(){this.isFixed=!1,this.isAsleep=!1,this.id=1,this.contactList=[],this.pointsArray=pointsArray,this.centroid=[0,0],this.vertices=[],this.referenceVertices=[],this.X=0,this.Y=0,this.mass=0,this.momentOfInertia=0,this.gravity=!0,this.rotationalKineticEnergy=0,this.translationalKineticEnergy=0,this.velocity=[0,0],this.angularVelocity=0,this.radius=50,this.distances=[],this.findOuterRadius=function(){this.distances=this.vertices.map(function(a){return distance(a[0]+50,a[1]+50)})},this.outerRadius=0,this.setOuterRadius=function(){return this.outerRadius=Math.max.apply(null,this.distances),this.outerRadius},this.boundingRectangle={minX:0,minY:0,width:0,height:0},this.distancesX=[],this.findBoundingRectX=function(){this.distancesX=this.vertices.map(function(a){return a[0]})},this.boundingRectMaxX=0,this.findBoundingRectMaxX=function(){return this.findBoundingRectX(),this.boundingRectMaxX=Math.max.apply(null,this.distancesX),this.boundingRectMaxX},this.boundingRectMinX=0,this.findBoundingRectMinX=function(){return this.findBoundingRectX(),this.boundingRectMinX=Math.min.apply(null,this.distancesX),this.boundingRectMinX},this.distancesY=[],this.findBoundingRectY=function(){this.distancesY=this.vertices.map(function(a){return a[1]})},this.boundingRectMaxY=0,this.findBoundingRectMaxY=function(){return this.findBoundingRectY(),this.boundingRectMaxY=Math.max.apply(null,this.distancesY),this.boundingRectMaxY},this.boundingRectMinY=0,this.findBoundingRectMinY=function(){return this.findBoundingRectY(),this.boundingRectMinY=Math.min.apply(null,this.distancesY),this.boundingRectMinY},this.makeBoundingRect=function(){this.boundingRectangle={minX:this.findBoundingRectMinX(),minY:this.findBoundingRectMinY(),width:this.findBoundingRectMaxX()-this.findBoundingRectMinX(),height:this.findBoundingRectMaxY()-this.findBoundingRectMinY()}},this.preCollision=!1,this.collision=!1,this.collisionPoint={x:0,y:0,velocity:[0,0]},this.stretchRadius=50,this.onObject=!1,this.dragging=!1,this.colour="#6d9eeb",this.expand=!1,this.h_expand=!1,this.v_expand=!1,this.expandBox=!1,this.sliderPosition=0,this.rotationLine=!1,this.selected=!1,this.slider=[0,0],this.copy=!0,this.lineColour="black",this.lineWidth=.7,this.touchPoints=[0,0],this.locateTouchPoint=function(){this.touchPoints=[mousePos.x-this.X,mousePos.y-this.Y]},this.pickColour=function(){this.colour=chooseColour()},this.resize=function(){for(var a,b=0;b<this.pointsArray.length;b++)this.expand&&(a=Math.sqrt(2)*(this.stretchRadius+selectSize)-this.stretchRadius,this.vertices[b][0]*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.stretchRadius,this.vertices[b][1]*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.stretchRadius,this.findOuterRadius()),this.h_expand&&(a=selectSize,this.vertices[b][0]*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.stretchRadius,this.findOuterRadius()),this.v_expand&&(a=selectSize,this.vertices[b][1]*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.stretchRadius,this.findOuterRadius());this.expand&&(this.radius*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.radius),this.stretchRadius*=(distance(mousePos.x-this.X,mousePos.y-this.Y)-a)/this.stretchRadius,this.referencer(),this.findOuterRadius()},this.referencer=function(){for(var a=0;a<this.pointsArray.length;a++)this.referenceVertices[a]=[0,0],this.referenceVertices[a][0]=this.vertices[a][0],this.referenceVertices[a][1]=this.vertices[a][1];sliderPosition=0,this.sliderPosition=0,rotationRecalculation(this)},this.rotate=function(){var a=[];if(rotVertices2[0])for(var b=0;b<this.pointsArray.length;b++)this.vertices[b][0]-=rotVertices2[b][0],this.vertices[b][1]-=rotVertices2[b][1];for(var c=0;c<this.pointsArray.length;c++){var a=rotater2(0,0,this.referenceVertices[c][0],this.referenceVertices[c][1],2*sliderPosition*Math.PI/sliderButtonWidth);rotVertices2[c]=[0,0],rotVertices2[c][0]=a[0],rotVertices2[c][1]=a[1],this.vertices[c][0]+=a[0],this.vertices[c][1]+=a[1]}};var a;centralize(this,this.pointsArray,a),this.reverseX=function(a){for(var b=0;b<a.length;b++)a[b][0]*=-1;this.referencer()},this.reverseY=function(a){for(var b=0;b<a.length;b++)a[b][1]*=-1;this.referencer()},this.rotate180=function(a){for(var b=0;b<a.length;b++)a[b][0]*=-1,a[b][1]*=-1;this.referencer()},this.rotate90=function(a){for(var b=0;b<a.length;b++){var c=rotater2(0,0,this.vertices[b][0],this.vertices[b][1],Math.PI*sliderButtonWidth/4);a[b][0]+=c[0],a[b][1]+=c[1]}this.referencer()},this.setVertexCollision=function(a){for(var b=0;b<a.length;b++)this.vertices[b][3]={collision:!1}},this.calculateMass=function(a,b,c,d){for(var e=0,f=0,g=0,h=[0,0],i=[0,0],j=[],k=Math.ceil(b/d),l=Math.ceil(c/d),m=0;l>m;m++)for(var n=0;k>n;n++){j[0]=d*n+this.boundingRectangle.minX,j[1]=d*m+this.boundingRectangle.minY,bufferCtx.beginPath(),bufferCtx.moveTo(a[0][0],a[0][1]);for(var o=0;o<a.length;o++)bufferCtx.lineTo(a[o][0],a[o][1]);bufferCtx.isPointInPath(j[0],j[1])&&(e++,h[0]+=j[0]+this.X,h[1]+=j[1]+this.Y)}h[0]=h[0]/e,h[1]=h[1]/e,i[0]=this.X-h[0],i[1]=this.Y-h[1],this.X=h[0],this.Y=h[1];for(var p=0;p<this.vertices.length;p++)this.vertices[p][0]+=i[0],this.vertices[p][1]+=i[1];f=d*d*e*massToPixelRatio,this.mass=f;for(var m=0;l>m;m++)for(var n=0;k>n;n++){j[0]=d*n+this.boundingRectangle.minX,j[1]=d*m+this.boundingRectangle.minY,bufferCtx.beginPath(),bufferCtx.moveTo(a[0][0],a[0][1]);for(var o=0;o<a.length;o++)bufferCtx.lineTo(a[o][0],a[o][1]);bufferCtx.isPointInPath(j[0],j[1])&&(g+=d*d*massToPixelRatio*(distance(j[0]-this.X,j[1]-this.Y)*distance(j[0]-this.X,j[1]-this.Y))*scale*scale)}this.momentOfInertia=g}}function customShapeGen(){var a=new CustomShape;customShapeArray[customShapeArray.length]=a,a.findOuterRadius(),a.setVertexCollision(a.vertices),numberOfShapes++,a.id=numberOfShapes,a.makeBoundingRect(),a.calculateMass(a.vertices,a.boundingRectangle.width,a.boundingRectangle.height,resolution)}function Walls(){this.mass=1/0,this.momentOfInertia=1/0,this.side=60,this.defaultSide=60,this.velocity=[0,0],this.pointsArray=[[1,1],[3,3],[4,4],[5,5],[6,6]],this.vertices=[],this.radius=this.side/2,this.stretchRadius=this.side/2,this.copy=!0;var a;centralize(this,this.pointsArray,a)}function wallGen(){var a=new Walls;wallArray[wallArray.length]=a,a.findOuterRadius()}function Curves(){this.pointsArray=pointsArray,this.centroid=[0,0],this.vertices=[0,0],this.velocity=[0,0],this.copy=!0,this.stroking=pointStroking;var a;centralize(this,this.pointsArray,a)}function curveGen(){var a=new Curves;curveArray[curveArray.length]=a,numberOfShapes++,a.id=numberOfShapes}function Square(){this.side=55,this.defaultSide=55,this.velocity=[0,0],this.pointsArray=[[mousePos.x-this.side/2,mousePos.y+this.side/2],[mousePos.x+this.side/2,mousePos.y+this.side/2],[mousePos.x+this.side/2,mousePos.y-this.side/2],[mousePos.x-this.side/2,mousePos.y-this.side/2],[mousePos.x-this.side/2,mousePos.y+this.side/2]],this.vertices=[],this.radius=2*this.side/3-5,this.stretchRadius=2*this.side/3,this.copy=!0;var a;centralize(this,this.pointsArray,a)}function squareGen(){if(0==onObject){var a=new Square;squareArray[squareArray.length]=a,a.findOuterRadius(),a.setVertexCollision(a.vertices),numberOfShapes++,a.id=numberOfShapes,a.makeBoundingRect(),a.calculateMass(a.vertices,a.boundingRectangle.width,a.boundingRectangle.height,resolution)}}function Circle(){this.side=55,this.defaultSide=55,this.velocity=[0,0],this.pointsArray=[];for(var a=circularArray.length,b=0;a>b;b++)this.pointsArray[b]=[0,0],this.pointsArray[b][0]=mousePos.x+circularArray[b][0],this.pointsArray[b][1]=mousePos.y+circularArray[b][1];this.pointsArray[a]=[0,0],this.pointsArray[a][0]=mousePos.x+circularArray[0][0],this.pointsArray[a][1]=mousePos.y+circularArray[0][1],this.vertices=[],this.radius=2*this.side/3-5,this.stretchRadius=2*this.side/3,this.copy=!0;var c;centralize(this,this.pointsArray,c)}function circleGen(){if(0==onObject){var a=new Circle;circleArray[circleArray.length]=a,a.findOuterRadius(),a.setVertexCollision(a.vertices),numberOfShapes++,a.id=numberOfShapes,a.makeBoundingRect(),a.calculateMass(a.vertices,a.boundingRectangle.width,a.boundingRectangle.height,resolution)}}function Triangle(){this.side=60,this.defaultSide=60,this.velocity=[0,0],this.pointsArray=[[mousePos.x-this.side/2,mousePos.y+Math.sqrt(3)/6*this.side],[mousePos.x+this.side/2,mousePos.y+Math.sqrt(3)/6*this.side],[mousePos.x,mousePos.y-2*Math.sqrt(3)/6*this.side],[mousePos.x-this.side/2,mousePos.y+Math.sqrt(3)/6*this.side]],this.vertices=[],this.radius=this.side/2,this.stretchRadius=this.side/2,this.copy=!0;var a;centralize(this,this.pointsArray,a)}function triangleGen(){if(0==onObject){var a=new Triangle;triangleArray[triangleArray.length]=a,a.findOuterRadius(),a.setVertexCollision(a.vertices),numberOfShapes++,a.id=numberOfShapes,a.makeBoundingRect(),a.calculateMass(a.vertices,a.boundingRectangle.width,a.boundingRectangle.height,resolution)}}function Pencil(a){var b=superPencilPoints.length;superPencilPoints[0]?this.pointsArray=superPencilPoints[b-1]:this.pointsArray=a,this.centroid=[0,0],this.vertices=[0,0],this.velocity=[0,0],this.copy=!0,stroking?this.stroking=!0:stroking||(this.stroking=!1);var c;pencils&&centralize(this,this.pointsArray,c)}function pencilGen(){if(0==onObject&&pencils&&pencilPointsArray[0]){var a=new Pencil;pencilArray[pencilArray.length]=a,a.findOuterRadius(),a.setVertexCollision(a.vertices),numberOfShapes++,a.id=numberOfShapes,a.makeBoundingRect(),a.calculateMass(a.vertices,a.boundingRectangle.width,a.boundingRectangle.height,resolution)}pencilPointsArray=[]}function centralize(a,b,c){for(var c=0;c<b.length-1;c++)a.X+=b[c][0],a.Y+=b[c][1];a.X/=b.length-1,a.Y/=b.length-1;for(var c=0;c<b.length;c++)a.vertices[c]=[0,0,!1],a.vertices[c][0]=b[c][0]-a.X,a.vertices[c][1]=b[c][1]-a.Y}function draw(){bufferCtx.fillStyle="#E0E0E0",bufferCtx.fillRect(0,0,canvas.width,canvas.height),circleDrawer(),squareDrawer(),triangleDrawer(),customShapeDrawer(),pencilDrawer(),curveDrawer(),wallDrawer(),shapeTransforms(pencilArray);var a;blueprint(customShapeArray,a),blueprint(circleArray,a),blueprint(squareArray,a),blueprint(triangleArray,a),blueprint(pencilArray,a),blueprint(curveArray,a),blueprint(wallArray,a),context.drawImage(bufferCanvas,0,0,canvas.width,canvas.height)}function calcAngle(a,b,c,d){return theta=0,0>c&&d>=0?(theta=Math.PI-angleFinder(a,b,c,d),Math.PI+theta):0>c&&0>d?(theta=2*Math.PI-angleFinder(a,b,c,d),theta):angleFinder(a,b,c,d)}function shadow(a,b){a[b].makeBoundingRect(),bufferCtx.fillStyle=a[b].colour,bufferCtx.strokeStyle=a[b].lineColour,bufferCtx.beginPath(),a[b].selected?(bufferCtx.lineWidth=1.4,bufferCtx.shadowColor="rgba( 9, 9, 9, 0.3)",bufferCtx.shadowOffsetX=10,bufferCtx.shadowOffsetY=10,bufferCtx.shadowBlur=10):(bufferCtx.shadowColor="transparent",bufferCtx.lineWidth=a[b].lineWidth),dragging&&a[b].selected&&(a[b].X=mousePos.x+offcenter[0],a[b].Y=mousePos.y+offcenter[1],select||(bufferCtx.lineWidth=1.4,bufferCtx.shadowColor="rgba( 9, 9, 9, 0.3)",bufferCtx.shadowOffsetX=10,bufferCtx.shadowOffsetY=10,bufferCtx.shadowBlur=10))}function changeSize(a,b){if(reSize&&(a[b].expand||a[b].v_expand||a[b].h_expand)&&a[b].resize(),reSize&&a[b].expandBox){bufferCtx.save(),bufferCtx.fillStyle="white",bufferCtx.strokeStyle="black",bufferCtx.lineWidth=.5;var c=7,d=14,e=0;for(bufferCtx.lineWidth=.7;c+e*d<2*(a[b].stretchRadius+selectSize);)bufferCtx.beginPath(),bufferCtx.moveTo(a[b].X-a[b].stretchRadius-selectSize+d*e,a[b].Y-a[b].stretchRadius-selectSize),bufferCtx.lineTo(a[b].X-a[b].stretchRadius-selectSize+c+d*e,a[b].Y-a[b].stretchRadius-selectSize),bufferCtx.stroke(),e++;for(e=0;c+e*d<2*(a[b].stretchRadius+selectSize);)bufferCtx.beginPath(),bufferCtx.moveTo(a[b].X-a[b].stretchRadius-selectSize+d*e,a[b].Y+a[b].stretchRadius+selectSize),bufferCtx.lineTo(a[b].X-a[b].stretchRadius-selectSize+c+d*e,a[b].Y+a[b].stretchRadius+selectSize),bufferCtx.stroke(),e++;for(e=0;c+e*d<2*(a[b].stretchRadius+selectSize);)bufferCtx.beginPath(),bufferCtx.moveTo(a[b].X-a[b].stretchRadius-selectSize,a[b].Y-a[b].stretchRadius-selectSize+d*e),bufferCtx.lineTo(a[b].X-a[b].stretchRadius-selectSize,a[b].Y-a[b].stretchRadius-selectSize+c+d*e),bufferCtx.stroke(),e++;for(e=0;c+e*d<2*(a[b].stretchRadius+selectSize);)bufferCtx.beginPath(),bufferCtx.moveTo(a[b].X+a[b].stretchRadius+selectSize,a[b].Y-a[b].stretchRadius-selectSize+d*e),bufferCtx.lineTo(a[b].X+a[b].stretchRadius+selectSize,a[b].Y-a[b].stretchRadius-selectSize+c+d*e),bufferCtx.stroke(),e++;bufferCtx.lineWidth=1.4,bufferCtx.globalAlpha=1,bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),
bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,a[b].Y-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-smallBox/2,a[b].Y-a[b].stretchRadius-selectSize+2*(a[b].stretchRadius+selectSize)-smallBox/2,smallBox,smallBox),bufferCtx.strokeRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-smallBox/2,smallBox,smallBox),bufferCtx.fillRect(a[b].X-a[b].stretchRadius-selectSize-smallBox/2,a[b].Y-smallBox/2,smallBox,smallBox),bufferCtx.restore()}}function changeColour(a,b){colourChange&&a[b].onObject&&a[b].pickColour()}function rotateShape(a,b){if(rotate&&a[b].rotationLine){var c=a[b].X-sliderButtonWidth/2,d=a[b].X+sliderButtonWidth/2,e=a[b].Y+a[b].radius+45,f=20;bufferCtx.save(),bufferCtx.globalAlpha=.7,bufferCtx.shadowColor="rgba( 9, 9, 9, 0.4)",bufferCtx.shadowOffsetX=10,bufferCtx.shadowOffsetY=10,bufferCtx.shadowBlur=10,bufferCtx.fillStyle="lightblue",bufferCtx.lineWidth=1,bufferCtx.beginPath(),bufferCtx.moveTo(c,e-f),bufferCtx.arc(d,e,f,-Math.PI/2,Math.PI/2),bufferCtx.lineTo(c,e+f),bufferCtx.arc(c,e,f,Math.PI/2,-Math.PI/2),bufferCtx.stroke(),bufferCtx.fill(),bufferCtx.restore(),bufferCtx.save(),bufferCtx.lineWidth=1,bufferCtx.shadowColor="rgba( 9, 9, 9, 0.4)",bufferCtx.shadowOffsetX=10,bufferCtx.shadowOffsetY=10,bufferCtx.shadowBlur=10,bufferCtx.beginPath(),bufferCtx.moveTo(c,e),bufferCtx.lineTo(d,e),bufferCtx.stroke(),a[b].slider[0]=c+sliderPosition,a[b].slider[1]=e,rotate&&onSlider&&mousePos.x>=c&&mousePos.x<=d&&(a[b].slider[0]=mousePos.x,sliderPosition=mousePos.x-c,a[b].sliderPosition=mousePos.x-c,a[b].rotate()),bufferCtx.fillStyle="red",bufferCtx.beginPath(),bufferCtx.moveTo(a[b].slider[0]-4,a[b].slider[1]-8),bufferCtx.lineTo(a[b].slider[0]+4,a[b].slider[1]-8),bufferCtx.lineTo(a[b].slider[0],a[b].slider[1]),bufferCtx.closePath(),bufferCtx.fill(),bufferCtx.restore()}}function wallDrawer(){bufferCtx.lineWidth=.5,bufferCtx.strokeStyle="black",bufferCtx.globalAlpha=1,shapeTransforms(wallArray)}function circleDrawer(){bufferCtx.globalAlpha=1,bufferCtx.lineWidth=.5,!dragging&&shapeSelection.shapes.circle[0]&&mousePos.x<=canvas.width-25&&mousePos.y<=canvas.height-25&&!onObject&&(bufferCtx.beginPath(),bufferCtx.globalAlpha=.1,bufferCtx.fillStyle="blue",bufferCtx.arc(mousePos.x,mousePos.y,30,0,2*Math.PI),bufferCtx.stroke(),bufferCtx.fill()),bufferCtx.lineWidth=.5,bufferCtx.strokeStyle="black",bufferCtx.globalAlpha=1,shapeTransforms(circleArray)}function squareDrawer(){bufferCtx.globalAlpha=1,!dragging&&shapeSelection.shapes.square[0]&&mousePos.x<=canvas.width-25&&mousePos.y<=canvas.height-25&&!onObject&&(bufferCtx.globalAlpha=.1,bufferCtx.fillStyle="blue",bufferCtx.arc(mousePos.x,mousePos.y,30,0,2*Math.PI),bufferCtx.beginPath(),bufferCtx.moveTo(mousePos.x-27.5,mousePos.y+27.5),bufferCtx.lineTo(mousePos.x+27.5,mousePos.y+27.5),bufferCtx.lineTo(mousePos.x+27.5,mousePos.y-27.5),bufferCtx.lineTo(mousePos.x-27.5,mousePos.y-27.5),bufferCtx.closePath(),bufferCtx.stroke(),bufferCtx.fill()),bufferCtx.globalAlpha=1,shapeTransforms(squareArray)}function triangleDrawer(){bufferCtx.globalAlpha=1,!dragging&&shapeSelection.shapes.triangle[0]&&mousePos.x<=canvas.width-25&&mousePos.y<=canvas.height-25&&!onObject&&(bufferCtx.globalAlpha=.1,bufferCtx.fillStyle="blue",bufferCtx.arc(mousePos.x,mousePos.y,30,0,2*Math.PI),bufferCtx.beginPath(),bufferCtx.moveTo(mousePos.x-30,mousePos.y+Math.sqrt(3)/6*60),bufferCtx.lineTo(mousePos.x+30,mousePos.y+Math.sqrt(3)/6*60),bufferCtx.lineTo(mousePos.x,mousePos.y-2*Math.sqrt(3)/6*60),bufferCtx.closePath(),bufferCtx.stroke(),bufferCtx.fill()),bufferCtx.strokeStyle="black",bufferCtx.globalAlpha=1,bufferCtx.lineWidth=.5,shapeTransforms(triangleArray)}function customShapeDrawer(){if(shapes){bufferCtx.fillStyle="blue",bufferCtx.beginPath(),bufferCtx.arc(mousePos.x,mousePos.y,2,0,2*Math.PI),bufferCtx.fill(),startDraw&&bufferCtx.moveTo(pointsArray[0][0],pointsArray[0][1]),closedPath=!1;for(var a=0;a<pointsArray.length;a++)0!=a&&bufferCtx.lineTo(pointsArray[a][0],pointsArray[a][1]);startDraw?bufferCtx.lineTo(mousePos.x,mousePos.y):pointsArray[0]&&(bufferCtx.closePath(),customShapeGen(),pointsArray=[]),bufferCtx.stroke(),pointsArray[0]&&distance(pointsArray[0][0]-mousePos.x,pointsArray[0][1]-mousePos.y)<closePathRadius&&(bufferCtx.save(),bufferCtx.fillStyle="lightgreen",bufferCtx.beginPath(),bufferCtx.arc(pointsArray[0][0],pointsArray[0][1],closePathRadius,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore(),closedPath=!0)}shapeTransforms(customShapeArray)}function curveDrawer(){if(line){bufferCtx.strokeStyle="red",bufferCtx.fillStyle="blue",bufferCtx.beginPath(),bufferCtx.arc(mousePos.x,mousePos.y,2,0,2*Math.PI),bufferCtx.fill(),startDraw&&bufferCtx.moveTo(pointsArray[0][0],pointsArray[0][1]),closedPath=!1;for(var a=0;a<pointsArray.length;a++)0!=a&&bufferCtx.lineTo(pointsArray[a][0],pointsArray[a][1]);startDraw?bufferCtx.lineTo(mousePos.x,mousePos.y):pointsArray[0]&&(bufferCtx.closePath(),curveGen(),pointsArray=[]);var b=pointsArray[pointsArray.length-1];2==clickCount&&pointsArray[0]&&distance(mousePos.x-b[0],mousePos.y-b[1])<closePathRadius&&pointsArray.length>2&&(curveGen(),pointsArray=[],startDraw=!1),bufferCtx.stroke(),pointsArray[0]&&(pointStroking=!0,distance(pointsArray[0][0]-mousePos.x,pointsArray[0][1]-mousePos.y)<closePathRadius&&(bufferCtx.save(),bufferCtx.fillStyle="lightgreen",bufferCtx.beginPath(),bufferCtx.arc(pointsArray[0][0],pointsArray[0][1],closePathRadius,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore(),closedPath=!0,pointsArray.length>1&&(pointStroking=!1)))}shapeTransforms(curveArray)}function pencilDrawer(){if(pencilPointsArray[0]&&pencils&&!select){bufferCtx.beginPath(),bufferCtx.moveTo(pencilPointsArray[0][0],pencilPointsArray[0][1]);for(var a=0;a<pencilPointsArray.length;a++)bufferCtx.lineTo(pencilPointsArray[a][0],pencilPointsArray[a][1]);bufferCtx.stroke()}for(var a=0;a<pencilArray.length;a++)if(pencilPointsArray[0]){bufferCtx.beginPath(),bufferCtx.moveTo(pencilArray[a].X+pencilArray[a].vertices[0][0],pencilArray[a].Y+pencilArray[a].vertices[0][1]);for(var b=0;b<pencilArray[a].vertices.length;b++)pencilArray[a].vertices[b]&&bufferCtx.lineTo(pencilArray[a].X+pencilArray[a].vertices[b][0],pencilArray[a].Y+pencilArray[a].vertices[b][1])}}function shapeTransforms(a){if(a[0])for(var b=0;b<a.length;b++){shadow(a,b),changeColour(a,b),bufferCtx.save();var c=a[b].vertices[0][0]+a[b].X,d=a[b].vertices[0][1]+a[b].Y;bufferCtx.beginPath(),bufferCtx.moveTo(c,d);for(var e=0;e<a[b].vertices.length;e++){var f=a[b].vertices[e][0]+a[b].X,g=a[b].vertices[e][1]+a[b].Y;a[b].vertices[e][2]&&(a[b].vertices[e][0]=mousePos.x-a[b].X,a[b].vertices[e][1]=mousePos.y-a[b].Y),bufferCtx.lineTo(f,g)}if(a!=pencilArray||a[b].stroking||bufferCtx.closePath(),bufferCtx.restore(),bufferCtx.stroke(),a!=pencilArray||a[b].stroking?a!=pencilArray&&(a[b].stroking||bufferCtx.fill()):bufferCtx.fill(),a==circleArray&&(bufferCtx.beginPath(),bufferCtx.moveTo(a[b].X+a[b].vertices[0][0],a[b].Y+a[b].vertices[0][1]),bufferCtx.lineTo(a[b].X,a[b].Y),bufferCtx.stroke()),reShape){onReshape=!1;for(var e=0;e<a[b].vertices.length;e++){var f=a[b].vertices[e][0]+a[b].X,g=a[b].vertices[e][1]+a[b].Y;if(distance(mousePos.x-f,mousePos.y-g)<5){onReshape=!0,bufferCtx.fillStyle="darkblue";for(var h=0;h<a[b].vertices.length;h++){var f=a[b].vertices[h][0]+a[b].X,g=a[b].vertices[h][1]+a[b].Y;bufferCtx.beginPath(),bufferCtx.arc(f,g,3,0,2*Math.PI),bufferCtx.fill()}}}}physics&&a!=wallArray&&a[b].gravity&&(a[b].velocity[1]+=gravity/20),changeSize(a,b),rotateShape(a,b)}}function backgroundGradient(a){$(a).css({"background-image":"-webkit-linear-gradient(bottom, black , #404040)"}),$(a).css({"background-image":"-o-linear-gradient(bottom, black , #404040)"}),$(a).css({"background-image":"-moz-linear-gradient(bottom, black , #404040)"}),$(a).css({"background-image":"linear-gradient(to bottom, #404040 ,black)"})}function shapeSelector(a){return"navigation-bar"===a?(colourChange=!1,void backgroundGradient("#ChangeColour")):(a&&"ChangeColour"===a?colourChange=!0:"ChangeColour"!==a&&(colourChange=!1),a&&"physics"===a&&(physics===!0?physics=!1:physics===!1&&(physics=!0)),shapeSelection.shapes.circle[0]=!1,shapeSelection.shapes.square[0]=!1,shapeSelection.shapes.triangle[0]=!1,deletion=!1,reSize=!1,reShape=!1,rotate=!1,shapes=!1,pencils=!1,copy=!1,circles=!1,triangles=!1,squares=!1,line=!1,saving=!1,options(),backgroundGradient("#circle"),backgroundGradient("#square"),backgroundGradient("#triangle"),backgroundGradient("#customShape"),backgroundGradient("#Re-Size"),backgroundGradient("#Rotate"),backgroundGradient("#ChangeColour"),backgroundGradient("#erase"),backgroundGradient("#save"),backgroundGradient("#pencil_id"),backgroundGradient("#Re-Shape"),backgroundGradient("#copy"),backgroundGradient("#physics"),image.style.visibility="hidden",$("#pencilList").css("display","none"),$("#rotateList").css("display","none"),void pencilCursor())}function gradient(a){a.style.background="-webkit-linear-gradient(top, black , #404040)",a.style.background="-o-linear-gradient(top, black , #404040)",a.style.background="-moz-linear-gradient(top, black , #404040)",a.style.background="linear-gradient(to top, #404040 ,black)"}function hover(a){a.style.background="-webkit-linear-gradient(top, black , #404040)",a.style.background="-o-linear-gradient(top, black , #404040)",a.style.background="-moz-linear-gradient(top, black , #404040)",a.style.background="linear-gradient(to top, #404040 ,black)"}function leave(a,b){a||(b.style.background="-webkit-linear-gradient(bottom, black , #404040)",b.style.background="-o-linear-gradient(bottom, black , #404040)",b.style.background="-moz-linear-gradient(bottom, black , #404040)",b.style.background="linear-gradient(to bottom, #404040 ,black)")}function shapeSelect(){for(key in shapeSelection.shapes)if("userID"!=key&&"isPublic"!=key&&"name"!=key&&shapeSelection.shapes[key][0])return[shapeSelection.shapes[key][1](),shapeSelection.shapes[key][2]]}function colourPicker(){colours.transparent[1]=!1,colours.blue[1]=!1,colours.red[1]=!1,colours.yellow[1]=!1,colours.green[1]=!1,colours.white[1]=!1,colours.black[1]=!1,colours.lightblue[1]=!1,colours.lightgreen[1]=!1,colours.orange[1]=!1,colours.purple[1]=!1,colours.violet[1]=!1,colours.beige[1]=!1,colours.aqua[1]=!1,colours.grey[1]=!1,colours.pink[1]=!1}function chooseColour(){return selectedColour}function clearAll(a){for(e in shapeSelection.shapes)if("wall"!=e||"wall"==e&&a.clearWall){var b=shapeSelection.shapes[e][2];b.splice(0,b.length)}}function loadShapes(a){for(key in a.shapes)for(var b=0;b<a.shapes[key][2].length;b++){if(shapeSelection.shapes[key][2][b]={},"circle"==key){var c=new Circle;shapeSelection.shapes[key][2][b]=c}if("square"==key){var d=new Square;shapeSelection.shapes[key][2][b]=d}if("triangle"==key){var e=new Triangle;shapeSelection.shapes[key][2][b]=e}if("customShape"==key){var f=new CustomShape;shapeSelection.shapes[key][2][b]=f}if("pencil"==key){var g=a.shapes[key][2][b].pointsArray,h=new Pencil(g);shapeSelection.shapes[key][2][b]=h}if("wall"==key){var i=new Walls;shapeSelection.shapes[key][2][b]=i}for(prop in a.shapes[key][2][b])shapeSelection.shapes[key][2][b][prop]=a.shapes[key][2][b][prop];("wall"==key||shapeSelection.shapes[key][2][b].isFixed)&&(shapeSelection.shapes[key][2][b].mass=1/0,shapeSelection.shapes[key][2][b].momentOfInertia=1/0)}}function loadShapes_idb(a){for(key in a.shapes)for(var b=0;b<a.shapes[key].length;b++){if(shapeSelection.shapes[key][2][b]={},"circle"==key){var c=new Circle;shapeSelection.shapes[key][2][b]=c}if("square"==key){var d=new Square;shapeSelection.shapes[key][2][b]=d}if("triangle"==key){var e=new Triangle;shapeSelection.shapes[key][2][b]=e}if("customShape"==key){var f=new CustomShape;shapeSelection.shapes[key][2][b]=f}if("pencil"==key){var g=a.shapes[key][2][b].pointsArray,h=new Pencil(g);shapeSelection.shapes[key][2][b]=h}if("wall"==key){var i=new Walls;shapeSelection.shapes[key][2][b]=i}for(prop in a.shapes[key][b])shapeSelection.shapes[key][2][b][prop]=a.shapes[key][b][prop];("wall"==key||shapeSelection.shapes[key][2][b].isFixed)&&(shapeSelection.shapes[key][2][b].mass=1/0,shapeSelection.shapes[key][2][b].momentOfInertia=1/0)}return shapeSelection.name=a.name,shapeSelection.imgURL=a.imgURL,shapeSelection}function collisionShadow(){if(showBlueprint.collisionShadow&&showBlueprint.on&&collidingShapes[0][0]){bufferCtx.save(),bufferCtx.strokeStyle="black",bufferCtx.lineWidth=.3,bufferCtx.globalAlpha=.03;for(var a=0;a<collidingShapes.length;a++){0==a&&(bufferCtx.fillStyle="green"),1==a&&(bufferCtx.fillStyle="blue"),bufferCtx.beginPath(),bufferCtx.moveTo(collidingShapes[a][0][0],collidingShapes[a][0][1]);for(var b=0;b<collidingShapes[a].length;b++)bufferCtx.lineTo(collidingShapes[a][b][0],collidingShapes[a][b][1]);bufferCtx.stroke(),bufferCtx.fill()}bufferCtx.restore()}}function checkbox(a){return selectAll?(a.checked=!0,!0):reset?(a.checked=!1,!1):a.checked?!0:a.checked?void 0:!1}function displayData(){var a=document.getElementById("normal"),b=document.getElementById("repulsionA"),c=document.getElementById("repulsionB"),d=document.getElementById("colPointRelVel"),e=document.getElementById("collisionPoint"),f=document.getElementById("collidingSide"),g=document.getElementById("collisionShadow"),h=document.getElementById("boundingRect"),i=document.getElementById("preCollision"),j=document.getElementById("centroid"),k=document.getElementById("shadowCentroid");checkbox(a)?showBlueprint.arrow.normal=!0:showBlueprint.arrow.normal=!1,checkbox(b)?showBlueprint.arrow.repulsionA=!0:showBlueprint.arrow.repulsionA=!1,checkbox(c)?showBlueprint.arrow.repulsionB=!0:showBlueprint.arrow.repulsionB=!1,checkbox(d)?showBlueprint.arrow.relativeCollisionPointVelocity=!0:showBlueprint.arrow.relativeCollisionPointVelocity=!1,checkbox(e)?showBlueprint.collisionPoint=!0:showBlueprint.collisionPoint=!1,checkbox(f)?showBlueprint.collidingSide=!0:showBlueprint.collidingSide=!1,checkbox(g)?showBlueprint.collisionShadow=!0:showBlueprint.collisionShadow=!1,checkbox(h)?showBlueprint.boundingRect=!0:showBlueprint.boundingRect=!1,checkbox(i)?showBlueprint.preCollision=!0:showBlueprint.preCollision=!1,checkbox(j)?showBlueprint.centroid=!0:showBlueprint.centroid=!1,checkbox(k)?showBlueprint.shadowCentroid=!0:showBlueprint.shadowCentroid=!1}function arrow(a,b,c){if(showBlueprint.arrow[c]){var d=[a[0],a[1]],e=[a[0],a[1]-1],f=[e[0]-d[0],e[1]-d[1]],g=[b[0]-a[0],b[1]-a[1]],h=distance([a[0]-b[0]],[a[1]-b[1]]);e=[a[0],a[1]-h];var i=calcAngle(f[0],f[1],g[0],g[1]);showBlueprint.on&&(bufferCtx.save(),bufferCtx.translate(a[0],a[1]),bufferCtx.rotate(i),bufferCtx.translate(-a[0],-a[1]),"normal"===c?bufferCtx.strokeStyle="#484848  ":"repulsionA"===c?bufferCtx.strokeStyle="green":"repulsionB"===c?bufferCtx.strokeStyle="blue":"relativeCollisionPointVelocity"===c?bufferCtx.strokeStyle="black":bufferCtx.strokeStyle="black",bufferCtx.lineWidth=1,bufferCtx.beginPath(),bufferCtx.moveTo(a[0],a[1]),bufferCtx.lineTo(e[0],e[1]),bufferCtx.stroke(),"normal"===c?bufferCtx.fillStyle="#484848  ":"repulsionA"===c?bufferCtx.fillStyle="green":"repulsionB"===c?bufferCtx.fillStyle="blue":"relativeCollisionPointVelocity"===c?bufferCtx.fillStyle="black":bufferCtx.fillStyle="black",bufferCtx.beginPath(),bufferCtx.moveTo(e[0],e[1]-6),bufferCtx.lineTo(e[0]-4,e[1]),bufferCtx.lineTo(e[0]+4,e[1]),bufferCtx.fill(),bufferCtx.restore())}}function blueprint(a,b){showBlueprint.on&&showBlueprint.collidingSide&&(bufferCtx.save(),bufferCtx.strokeStyle="red",bufferCtx.lineWidth=1,bufferCtx.beginPath(),bufferCtx.moveTo(startPoint[0],startPoint[1]),bufferCtx.lineTo(endPoint[0],endPoint[1]),bufferCtx.stroke(),bufferCtx.restore()),collidingShapes[0]=[];for(var c=0;c<shapeA.length;c++)collidingShapes[0][c]=[],collidingShapes[0][c][0]=shapeACenter[0]+shapeA[c][0],collidingShapes[0][c][1]=shapeACenter[1]+shapeA[c][1];collidingShapes[1]=[];for(var c=0;c<shapeB.length;c++)collidingShapes[1][c]=[],collidingShapes[1][c][0]=shapeBCenter[0]+shapeB[c][0],collidingShapes[1][c][1]=shapeBCenter[1]+shapeB[c][1];if(showBlueprint.shadowCentroid&&(bufferCtx.save(),bufferCtx.fillStyle="green",bufferCtx.globalAlpha=.2,bufferCtx.beginPath(),bufferCtx.arc(shapeACenter[0],shapeACenter[1],3,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore(),bufferCtx.save(),bufferCtx.fillStyle="blue",bufferCtx.globalAlpha=.2,bufferCtx.beginPath(),bufferCtx.arc(shapeBCenter[0],shapeBCenter[1],3,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore()),arrow([calculatedCollisionPointX,calculatedCollisionPointY],[calculatedCollisionPointX+20*normalVector_x,calculatedCollisionPointY+20*normalVector_y],"normal"),arrow([shapeACenter[0],shapeACenter[1]],[shapeACenter[0]-200*repulsiveF[0],shapeACenter[1]-200*repulsiveF[1]],"repulsionA"),arrow([shapeBCenter[0],shapeBCenter[1]],[shapeBCenter[0]+200*repulsiveF[0],shapeBCenter[1]+200*repulsiveF[1]],"repulsionB"),arrow([calculatedCollisionPointX,calculatedCollisionPointY],[calculatedCollisionPointX+20*colVelocity[0],calculatedCollisionPointY+20*colVelocity[1]],"relativeCollisionPointVelocity"),collisionShadow(),showBlueprint.collisionPoint&&showBlueprint.on&&(bufferCtx.save(),bufferCtx.fillStyle="black",bufferCtx.beginPath(),bufferCtx.arc(calculatedCollisionPointX,calculatedCollisionPointY,2,0,2*Math.PI),bufferCtx.fill(),bufferCtx.fillStyle="yellow",bufferCtx.beginPath(),bufferCtx.arc(calculatedCollisionPointX,calculatedCollisionPointY,1,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore()),showBlueprint.on){bufferCtx.fillStyle="#505050",bufferCtx.font="13px sans-serif",bufferCtx.fillText("("+mousePos.x+", "+mousePos.y+")",mousePos.x,mousePos.y-30);for(var b=0;b<a.length;b++){if(showBlueprint.centroid&&(bufferCtx.fillStyle="black",bufferCtx.beginPath(),bufferCtx.arc(a[b].X,a[b].Y,3,0,2*Math.PI),bufferCtx.fill()),showBlueprint.all){bufferCtx.save();for(var d=0;d<a[b].vertices.length;d++)a[b].vertices[d][3]&&a[b].vertices[d][3].collision&&(bufferCtx.fillStyle="red",bufferCtx.beginPath(),bufferCtx.arc(a[b].X+a[b].vertices[d][0],a[b].Y+a[b].vertices[d][1],5,0,2*Math.PI),bufferCtx.fill());bufferCtx.restore(),bufferCtx.beginPath(),bufferCtx.arc(a[b].X,a[b].Y,4,0,2*Math.PI),bufferCtx.fill(),bufferCtx.beginPath(),bufferCtx.arc(a[b].X,a[b].Y,a[b].radius,0,2*Math.PI),bufferCtx.stroke(),bufferCtx.strokeStyle="red",bufferCtx.beginPath(),bufferCtx.arc(a[b].X,a[b].Y,a[b].stretchRadius,0,2*Math.PI),bufferCtx.stroke(),bufferCtx.strokeStyle="black",bufferCtx.fillStyle="white",bufferCtx.beginPath(),bufferCtx.arc(a[b].centroid[0],a[b].centroid[1],3,0,2*Math.PI),bufferCtx.fill(),bufferCtx.stroke()}if(a[b].preCollision&&showBlueprint.preCollision)if(bufferCtx.save(),bufferCtx.strokeStyle="green",bufferCtx.lineWidth=.7,bufferCtx.beginPath(),bufferCtx.arc(a[b].X,a[b].Y,a[b].setOuterRadius(),0,2*Math.PI),bufferCtx.stroke(),a[b].collision){bufferCtx.fillStyle="black",bufferCtx.strokeStyle="black";var e=a[b].X+a[b].collisionPoint.x,f=a[b].Y+a[b].collisionPoint.y;a[b].lineColour="blue",a[b].lineWidth=4,bufferCtx.beginPath(),bufferCtx.moveTo(e,f),bufferCtx.lineTo(e+100*a[b].collisionPoint.velocity[0],f+100*a[b].collisionPoint.velocity[1]),bufferCtx.stroke(),bufferCtx.beginPath(),bufferCtx.arc(e,f,3,0,2*Math.PI),bufferCtx.fill(),bufferCtx.restore()}else a[b].lineColour="black",a[b].lineWidth=.7,bufferCtx.restore();showBlueprint.boundingRect&&(bufferCtx.save(),bufferCtx.rect(a[b].boundingRectangle.minX+a[b].X,a[b].boundingRectangle.minY+a[b].Y,a[b].boundingRectangle.width,a[b].boundingRectangle.height),bufferCtx.stroke(),bufferCtx.restore())}}}function isPointInShape(a,b,c,d){bufferCtx.beginPath(),bufferCtx.moveTo(b[0][0]+c,b[0][1]+d);for(var e=0;e<b.length;e++)bufferCtx.lineTo(b[e][0]+c,b[e][1]+d);return bufferCtx.isPointInPath(a[0],a[1])?!0:!1}function sameDirection(a,b){return distance(a[0]+b[0],a[1]+b[1])>distance(a[0]-b[0],a[1]-b[1])?!0:distance(a[0]+b[0],a[1]+b[1])<distance(a[0]-b[0],a[1]-b[1])?!1:void 0}function normalVector(a,b,c,d,e,f){var g=!1,h=-1/a,i=Math.atan(h),j=[Math.cos(i),Math.sin(i)];c[0]-=1*j[0],c[1]-=1*j[1],isPointInShape(c,d,e,f)||(j[0]*=-1,j[1]*=-1,g=!0);isPointInShape(c,d,e,f);return[j[0],j[1],g]}function sortRange(a){return a[0]>a[1]?[a[1],a[0]]:a[0]<a[1]?[a[0],a[1]]:a}function xyRange(a){var b=sortRange([a[0][0],a[1][0]]),c=sortRange([a[0][1],a[1][1]]);return[b,c]}function overlap(a,b){return a[0]>b[1]?!1:a[1]<b[0]?!1:!0}function defineLine(a){var b=a[1][0]-a[0][0],c=a[1][1]-a[0][1],d=c/b,e=a[1][1]-d*a[1][0],f={gradient:d,yIntercept:e};return f}function findIntersectionPoint(a,b){var c=defineLine(a),d=defineLine(b),e=c.gradient,f=c.yIntercept,g=d.gradient,h=d.yIntercept;if(e!==g){if(0!==g&&Math.abs(g)!==1/0)if(0===e)var i=a[0][1],j=(i-h)/g;else if(Math.abs(e)===1/0){var j=a[0][0];console.log;var i=g*j+h}if(0!==e&&Math.abs(e)!==1/0)if(0===g)var i=b[0][1],j=(i-f)/e;else if(Math.abs(g)===1/0)var j=b[0][0],i=e*j+f;if(0!==g&&Math.abs(g)!==1/0&&0!==e&&Math.abs(e)!==1/0)var j=(h-f)/(e-g),i=e*j+f;if(0===e&&Math.abs(g)===1/0)var j=b[0][0],i=a[0][1];else if(0===g&&Math.abs(e)===1/0)var j=a[0][0],i=b[0][1];return j>=xyRange(a)[0][0]&&j<=xyRange(a)[0][1]?{intersecting:!0,intersectionPoint:[j,i]}:{intersecting:!1,intersectionPoint:[j,i]}}if(e===g&&f!==h)return{intersecting:!1,intersectionPoint:[null,null]};if(e===g&&f===h){var k=xyRange(a)[0],l=xyRange(b)[0];return overlap(k,l)?{intersecting:!0,intersectionPoint:[null,null]}:{intersecting:!1,intersectionPoint:[null,null]}}}function intersect(a,b){var c=xyRange(a),d=xyRange(b),e=c[0],f=c[1],g=d[0],h=d[1];return overlap(e,g)&&overlap(f,h)?findIntersectionPoint(a,b):{intersecting:!1,intersectionPoint:[null,null]}}function intersectingLines(a,b,c){return c===!0?findIntersectionPoint(a,b):c===!1?intersect(a,b):void 0}function distanceFromLine(a,b){var c=defineLine(b).gradient,d=-1/c,e=[a[0]+1,a[1]+d],f=[a,e],g=findIntersectionPoint(b,f).intersectionPoint,h=distance(g[0]-a[0],g[1]-a[1]);return h}function physTest(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)physics&&dragging&&shapeSelection.shapes[key][2][a].selected&&(shapeSelection.shapes[key][2][a].angularVelocity=0)}function physMove(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)if(physics&&dragging&&shapeSelection.shapes[key][2][a].selected){physicsObject.throwArray.push([mousePos.x,mousePos.y]);var b=physicsObject.throwArray.length-1;if(physicsObject.throwArray.length>3){var c=(physicsObject.throwArray[b][0]-physicsObject.throwArray[b-1][0]+physicsObject.throwArray[b-1][0]-physicsObject.throwArray[b-2][0]+physicsObject.throwArray[b-2][0]-physicsObject.throwArray[b-3][0])/3,d=(physicsObject.throwArray[b][1]-physicsObject.throwArray[b-1][1]+physicsObject.throwArray[b-1][1]-physicsObject.throwArray[b-2][1]+physicsObject.throwArray[b-2][1]-physicsObject.throwArray[b-3][1])/3;shapeSelection.shapes[key][2][a].velocity[0]=c,shapeSelection.shapes[key][2][a].velocity[1]=d;var e=shapeSelection.shapes[key][2][a].touchPoints[0]-shapeSelection.shapes[key][2][a].X,f=shapeSelection.shapes[key][2][a].touchPoints[1]-shapeSelection.shapes[key][2][a].Y,g=f/e,h=[-e/g,-f/g],i=distance(c,d),j=angleCalc(h[0],h[1],c,d);angularVelocity=i*Math.cos(j)}}}function clearPhysMove(){for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++)physics&&shapeSelection.shapes[key][2][a].selected&&(physicsObject.throwArray=[])}function collisionDetector(){if(physics)for(key in shapeSelection.shapes)for(var a=0;a<shapeSelection.shapes[key][2].length;a++){shapeSelection.shapes[key][2][a].preCollision=!1;for(unit in shapeSelection.shapes)for(var b=0;b<shapeSelection.shapes[unit][2].length;b++)if((a!==b||key!==unit)&&(distance(shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[unit][2][b].Y)<shapeSelection.shapes[key][2][a].setOuterRadius()+shapeSelection.shapes[unit][2][b].setOuterRadius()||"wall"==unit&&0==b&&shapeSelection.shapes[key][2][a].X<shapeSelection.shapes[key][2][a].setOuterRadius()||"wall"==unit&&1==b&&shapeSelection.shapes[key][2][a].X+shapeSelection.shapes[key][2][a].setOuterRadius()>canvas.width||"wall"==unit&&2==b&&shapeSelection.shapes[key][2][a].Y+shapeSelection.shapes[key][2][a].setOuterRadius()>canvas.height||"wall"==unit&&3==b&&shapeSelection.shapes[key][2][a].Y<shapeSelection.shapes[key][2][a].setOuterRadius()+50)){shapeSelection.shapes[key][2][a].preCollision=!0;for(var c=0;c<shapeSelection.shapes[key][2][a].vertices.length;c++){var d=[shapeSelection.shapes[key][2][a].vertices[c][0]+shapeSelection.shapes[key][2][a].X,shapeSelection.shapes[key][2][a].vertices[c][1]+shapeSelection.shapes[key][2][a].Y];if(isPointInShape([d[0],d[1]],shapeSelection.shapes[unit][2][b].vertices,shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[unit][2][b].Y)){if(shapeSelection.shapes[key][2][a].contactList[0]=shapeSelection.shapes[unit][2][b].id,shapeSelection.shapes[key][2][a].vertices[c][3].collision===!1){var e=shapeSelection.shapes[key][2][a].mass,f=shapeSelection.shapes[key][2][a].momentOfInertia;shapeSelection.shapes[key][2][a].collisionPoint.x=shapeSelection.shapes[key][2][a].vertices[c][0],shapeSelection.shapes[key][2][a].collisionPoint.y=shapeSelection.shapes[key][2][a].vertices[c][1],collisionPointA_x=shapeSelection.shapes[key][2][a].collisionPoint.x,collisionPointA_y=shapeSelection.shapes[key][2][a].collisionPoint.y;var g=rotater2(0,0,shapeSelection.shapes[key][2][a].collisionPoint.x,shapeSelection.shapes[key][2][a].collisionPoint.y,shapeSelection.shapes[key][2][a].angularVelocity);shapeSelection.shapes[key][2][a].collisionPoint.velocity[0]=shapeSelection.shapes[key][2][a].velocity[0]+g[0],shapeSelection.shapes[key][2][a].collisionPoint.velocity[1]=shapeSelection.shapes[key][2][a].velocity[1]+g[1];var h=shapeSelection.shapes[key][2][a].collisionPoint.velocity[0],i=shapeSelection.shapes[key][2][a].collisionPoint.velocity[1],j=shapeSelection.shapes[unit][2][b].mass,k=shapeSelection.shapes[unit][2][b].momentOfInertia;shapeSelection.shapes[unit][2][b].collisionPoint.x=collisionPointA_x+shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[unit][2][b].collisionPoint.y=collisionPointA_y+shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[unit][2][b].Y;var l=shapeSelection.shapes[unit][2][b].collisionPoint.x,m=shapeSelection.shapes[unit][2][b].collisionPoint.y,n=rotater2(0,0,shapeSelection.shapes[unit][2][b].collisionPoint.x,shapeSelection.shapes[unit][2][b].collisionPoint.y,shapeSelection.shapes[unit][2][b].angularVelocity);shapeSelection.shapes[unit][2][b].collisionPoint.velocity[0]=shapeSelection.shapes[unit][2][b].velocity[0]+n[0],shapeSelection.shapes[unit][2][b].collisionPoint.velocity[1]=shapeSelection.shapes[unit][2][b].velocity[1]+n[1];var o=shapeSelection.shapes[unit][2][b].collisionPoint.velocity[0],p=shapeSelection.shapes[unit][2][b].collisionPoint.velocity[1],q=h-o,r=i-p,s=shapeSelection.shapes[key][2][a].velocity[0]-shapeSelection.shapes[unit][2][b].velocity[0],t=shapeSelection.shapes[key][2][a].velocity[1]-shapeSelection.shapes[unit][2][b].velocity[1];g[0],g[1];collision_Data=collisionData(d,[q,r],shapeSelection.shapes[key][2][a].vertices,[shapeSelection.shapes[key][2][a].X,shapeSelection.shapes[key][2][a].Y],shapeSelection.shapes[unit][2][b].vertices,[shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[unit][2][b].Y]),MagColVelocityAB=distance(q,r);distance(h,i),distance(o,p);normalVector_x=collision_Data.unitNormal[0],normalVector_y=collision_Data.unitNormal[1];var u=(angleCalc(normalVector_x,normalVector_y,q,r),q*normalVector_x+r*normalVector_y);crossVelocityANormal=collisionPointA_x*normalVector_y-collisionPointA_y*normalVector_x,crossVelocityBNormal=l*normalVector_y-m*normalVector_x;var v=-(1+restitution)*u/(1/e+1/j+crossVelocityANormal*crossVelocityANormal/f+crossVelocityBNormal*crossVelocityBNormal/k);e===1/0&&j===1/0&&f===1/0&&k===1/0&&(v=0),velocityChangeA_x=v*normalVector_x/e,velocityChangeA_y=v*normalVector_y/e,velocityChangeB_x=-v*normalVector_x/j,velocityChangeB_y=-v*normalVector_y/j,angularVelocityChangeA=v*crossVelocityANormal/f,angularVelocityChangeB=-v*crossVelocityBNormal/k,shapeSelection.shapes[key][2][a].velocity[0]+=velocityChangeA_x,shapeSelection.shapes[key][2][a].velocity[1]+=velocityChangeA_y,shapeSelection.shapes[unit][2][b].velocity[0]+=velocityChangeB_x,shapeSelection.shapes[unit][2][b].velocity[1]+=velocityChangeB_y,shapeSelection.shapes[key][2][a].angularVelocity+=angularVelocityChangeA,shapeSelection.shapes[unit][2][b].angularVelocity+=angularVelocityChangeB,shapeSelection.shapes[key][2][a].isFixed||(shapeSelection.shapes[key][2][a].velocity[0]-=s/20,shapeSelection.shapes[key][2][a].velocity[1]-=t/20);var w=distance(s,t);.05>w&&(shapeSelection.shapes[key][2][a].velocity[0]=0,shapeSelection.shapes[key][2][a].velocity[1]=0);var x=2;if(shapeSelection.shapes[key][2][a].X+=velocityChangeA_x*x,shapeSelection.shapes[key][2][a].Y+=velocityChangeA_y*x,shapeSelection.shapes[unit][2][b].X+=velocityChangeB_x*x,shapeSelection.shapes[unit][2][b].Y+=velocityChangeB_y*x,collisionCounter++,shapeSelection.shapes[key][2][a].vertices[c][3]={collision:!0},shapeSelection.shapes[unit][2][b].X,startPoint=collision_Data.collision_Data.sideOnB.first,endPoint=collision_Data.collision_Data.sideOnB.second,"wall"!=key){var y=100*MagColVelocityAB;MagColVelocityAB<.01&&"wall"!=unit&&(y=1);var z=distance(shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[unit][2][b].Y),A=[shapeSelection.shapes[key][2][a].X-shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[key][2][a].Y-shapeSelection.shapes[unit][2][b].Y],B=distance(collisionPointA_x+shapeSelection.shapes[key][2][a].X-collision_Data.collision_Data.x,collisionPointA_y+shapeSelection.shapes[key][2][a].Y-collision_Data.collision_Data.y);repulsion=[A[0]/z,A[1]/z];var C=.15;B>C&&(B=C);var D=collisionPointA_x+shapeSelection.shapes[key][2][a].X,E=collisionPointA_y+shapeSelection.shapes[key][2][a].Y,F=collision_Data.collision_Data.gradient;calculatedCollisionPointX=collision_Data.collision_Data.x,calculatedCollisionPointY=collision_Data.collision_Data.y,colVelocity=collision_Data.collision_Data.velocity,shapeA=[],shapeB=[];for(var G=0;G<shapeSelection.shapes[key][2][a].vertices.length;G++)shapeA[G]=[],shapeA[G][0]=shapeSelection.shapes[key][2][a].vertices[G][0],shapeA[G][1]=shapeSelection.shapes[key][2][a].vertices[G][1];for(var G=0;G<shapeSelection.shapes[unit][2][b].vertices.length;G++)shapeB[G]=[],shapeB[G][0]=shapeSelection.shapes[unit][2][b].vertices[G][0],shapeB[G][1]=shapeSelection.shapes[unit][2][b].vertices[G][1];shapeACenter=collision_Data.collision_Data.shapeACenter,shapeBCenter=collision_Data.collision_Data.shapeBCenter;var H=calculatedCollisionPointY-F*calculatedCollisionPointX,I=collision_Data.unitNormal[1]/collision_Data.unitNormal[0],J=E-I*D,K=(J-H)/(F-I),L=F*K+H;if(Math.abs(F)>=100){var M=1/F,N=calculatedCollisionPointX-M*calculatedCollisionPointY,O=1/I,P=D-O*E;L=(P-N)/(M-O),K=M*L+N}var Q=(distance(D-K,E-L),!1),R=[];R[0]=D+repulsion[0]*B,R[1]=E+repulsion[1]*B;distance(R[0]-K,R[1]-L);bufferCtx.beginPath(),bufferCtx.moveTo(shapeSelection.shapes[unit][2][b].vertices[0][0]+shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[unit][2][b].vertices[0][1]+shapeSelection.shapes[unit][2][b].Y);
for(var S=0;S<shapeSelection.shapes[unit][2][b].vertices.length;S++)bufferCtx.lineTo(shapeSelection.shapes[unit][2][b].vertices[S][0]+shapeSelection.shapes[unit][2][b].X,shapeSelection.shapes[unit][2][b].vertices[S][1]+shapeSelection.shapes[unit][2][b].Y);if(bufferCtx.isPointInPath(R[0],R[1])&&(Q=!0),"wall"!=key&&!shapeSelection.shapes[key][2][a].isFixed){[calculatedCollisionPointX-d[0],calculatedCollisionPointY-d[1]];shapeSelection.shapes[key][2][a].X+=normalVector_x*B,shapeSelection.shapes[key][2][a].Y+=normalVector_y*B}"wall"==unit||shapeSelection.shapes[unit][2][b].isFixed||(shapeSelection.shapes[unit][2][b].X-=normalVector_x*B,shapeSelection.shapes[unit][2][b].Y-=normalVector_y*B),repulsiveF[0]=-normalVector_x*B,repulsiveF[1]=-normalVector_y*B}}}else shapeSelection.shapes[key][2][a].vertices[c][3]={collision:!1},shapeSelection.shapes[key][2][a].contactList=[]}shapeSelection.shapes[key][2][a].collision=!1,shapeSelection.shapes[unit][2][b].collision=!1;for(var S=0;S<shapeSelection.shapes[key][2][a].vertices.length;S++)if(shapeSelection.shapes[key][2][a].vertices[S][3].collision){shapeSelection.shapes[key][2][a].collision=!0,shapeSelection.shapes[unit][2][b].collision=!0;break}}}}function collisionData(a,b,c,d,e,f){var g=[],h=[],i={},j=b[1]/b[0];0===b[0]&&(j=17976931348.623158);for(var k=a[1]-j*a[0],l=1;l<e.length;l++){var m=l-1,n=(e[m][1]-e[l][1])/(e[m][0]-e[l][0]);e[m][0]-e[l][0]===0&&(n=17976931348.623158);var o=e[l][1]-n*(e[l][0]+f[0])+f[1];if(n!=j){var p=(o-k)/(j-n),q=j*p+k;if(Math.abs(j)>=100){var r=1/j,s=1/n,t=a[0]-r*a[1],u=e[l][0]-s*(e[l][1]+f[1])+f[0];q=(u-t)/(r-s),p=r*q+t}var v=e[l][0]+f[0]-p,w=e[m][0]+f[0]-p,x=e[l][1]+f[1]-q,y=e[m][1]+f[1]-q;shapeB_X1=e[m][0]+f[0],shapeB_Y1=e[m][1]+f[1],shapeB_X2=e[l][0]+f[0],shapeB_Y2=e[l][1]+f[1],Math.abs(n)>1e-5&&Math.abs(n)<1e7?(1e-5>=v*w||1e-5>=x*y)&&h.push({intersection_x:p,intersection_y:q,gradient:n,sideOnB:{first:[shapeB_X1,shapeB_Y1],second:[shapeB_X2,shapeB_Y2]}}):Math.abs(n)<1e-5?1e-5>=v*w&&h.push({intersection_x:p,intersection_y:q,gradient:n,sideOnB:{first:[shapeB_X1,shapeB_Y1],second:[shapeB_X2,shapeB_Y2]}}):Math.abs(1/n)<1e-5&&1e-5>=x*y&&h.push({intersection_x:p,intersection_y:q,gradient:n,sideOnB:{first:[shapeB_X1,shapeB_Y1],second:[shapeB_X2,shapeB_Y2]}})}}for(var z,A=[],B=[],C=0;C<h.length;C++){var D=[h[C].intersection_x-a[0],h[C].intersection_y-a[1]],E=(distance(b[0],b[1]),distance(D[0],D[1]));A.push(E),B.push(E)}B.sort(function(a,b){return a-b});for(var F=0;F<h.length;F++)if(B[0]===A[F]){z=F;var G=[];G[0]=(h[F].sideOnB.first[0]+h[F].sideOnB.second[0])/2,G[1]=(h[F].sideOnB.first[1]+h[F].sideOnB.second[1])/2;var H=normalVector(h[F].gradient,b,G,e,f[0],f[1]);g=[H[0],H[1]],i={unitNormal:g,collision_Data:{x:h[F].intersection_x,y:h[F].intersection_y,gradient:h[F].gradient,sideOnB:h[F].sideOnB,shapeA:c,shapeB:e,shapeACenter:d,shapeBCenter:f,velocity:b},isColInternal:H[2]};break}return i}var circle,canvas,circleArray=[],squareArray=[],triangleArray=[],lineArray=[],customShapeArray=[],pencilArray=[],curveArray=[],wallArray=[],startPencil=!1,shapes=!1,circles=!1,triangles=!1,squares=!1,onObject=!1,dragging=!1,cursor_grab="-webkit-grabbing",cursor_drag="-webkit-grab",mousePos,selectedShape=[],frame_Rate=100,playScenes,selectedColour="",shapeSelection={name:"untitled",userID:null,isPublic:!0,imageUrl:"",canvas:{width:0,height:0},shapes:{circle:[!1,circleGen,circleArray,0],square:[!1,squareGen,squareArray,1],triangle:[!1,triangleGen,triangleArray,2],customShape:[!1,customShapeGen,customShapeArray,3],pencil:[!0,pencilGen,pencilArray,4],curve:[!1,curveGen,curveArray,5],wall:[!1,wallGen,wallArray,6]}},pencilPointsArray=[],superPencilPoints=[],triangle,square,shapeCounter=0,deletion=!1,reSize=!1,reShape=!1,onReshape=!1,expand=!1,colourChange=!1,selectSize=15,smallBox=9,colours={transparent:["transparent",!1],blue:["blue",!1],red:["red",!1],yellow:["yellow",!1],green:["green",!1],white:["white",!1],black:["black",!1],lightblue:["lightblue",!1],lightgreen:["lightgreen",!1],orange:["orange",!1],purple:["purple",!1],violet:["violet",!1],beige:["beige",!1],aqua:["aqua",!1],grey:["grey",!1],pink:["pink",!1]},rotate=!1,physics=!1,pencils=!0,copy=!1,onSlider=!1,sliderPosition=0,sliderButtonWidth=250,startDraw=!1,pointsArray=[],closedPath=!1,closePathRadius=5,rotVertices=0,rotVertices2=[],counter=0,saving=!1,screenWidth=screen.availWidth,screenHeight=screen.availHeight,tipping=!0,offcenter=[0,0],select=!1,stroking=!1,pointStroking=!0,reversingX=!1,reversingY=!1,rotating90=!1,rotating180=!1,copyArray=[],copying=!0,onBar=!1,line=!1,clickCount=0,mouse_down=!1,mergeDistance=5,collisionCounter=0,circularArray=[],numberOfShapes=0,currentlyReshaping=null;$(document).ready(function(){$("#strokes").click(function(){$("#strokes").css("color","white"),$("#shapes").css("color","#A3FFA3"),$("#strokes").css("text-decoration","underline"),$("#shapes").css("text-decoration","none"),stroking=!0}),$("#shapes").click(function(){$("#strokes").css("color","#A3FFA3"),$("#shapes").css("color","white"),$("#shapes").css("text-decoration","underline"),$("#strokes").css("text-decoration","none"),stroking=!1})}),$(document).ready(function(){$("#reverseX").click(function(){resetRotate(),$("#reverseX").css("color","white"),$("#reverseX").css("text-decoration","underline"),reversingX=!0}),$("#reverseY").click(function(){resetRotate(),$("#reverseY").css("color","white"),$("#reverseY").css("text-decoration","underline"),reversingY=!0}),$("#rotate90").click(function(){resetRotate(),$("#rotate90").css("color","white"),$("#rotate90").css("text-decoration","underline"),rotating90=!0}),$("#rotate180").click(function(){resetRotate(),$("#rotate180").css("color","white"),$("#rotate180").css("text-decoration","underline"),rotating180=!0})}),$(document).ready(function(){$("#bar").hover(function(){rotate&&$("#rotateList").fadeIn(250),$("#bar").mouseleave(function(){setTimeout(listStyleCallback,2500)})})}),$(document).ready(function(){$("#bar").hover(function(){pencils&&$("#pencilList").fadeIn(250),$("#bar").mouseleave(function(){setTimeout(listStyleCallback,2500)})})}),$(document).ready(function(){$("#bar").hover(function(){onBar=!0}),$("#bar").mouseleave(function(){onBar=!1})}),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}return"function"==typeof window.CustomEvent?!1:(a.prototype=window.Event.prototype,void(window.CustomEvent=a))}();var canvasReadyEvent=new CustomEvent("canvasReady",{detail:{hazcheeseburger:!0}});window.requestAnimFrame=function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var side=55;Walls.prototype=new CustomShape,Curves.prototype=new CustomShape,Square.prototype=new CustomShape,Circle.prototype=new CustomShape,Triangle.prototype=new CustomShape,Pencil.prototype=new CustomShape,wallConfig={clearWall:!1};var startPoint=[],endPoint=[],normalVector_x=[],normalVector_y=[],calculatedCollisionPointX=0,calculatedCollisionPointY=0,repulsiveF=[],shapeBCenter=[],shapeACenter=[],colVelocity=[],collidingShapes=[],index=0,shapeA=[],shapeB=[],shapeB=[],reset=!1,selectAll=!1,showBlueprint={on:!1,all:!1,physics:!0,collidingSide:!1,boundingRect:!1,preCollision:!1,collisionPoint:!1,collisionShadow:!1,centroid:!1,shadowCentroid:!1,arrow:{normal:!1,repulsionA:!1,repulsionB:!1,relativeCollisionPointVelocity:!1,collisionPointVelocity:!1}},obj={a:6,b:3,c:5},arr=[1,2,3],physicsObject={throwArray:[]},gravity=.1,restitution=.5,minBounceVelocity=5,massToPixelRatio=.01,scale=.1,resolution=1;